<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Advanced Task Manager</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            --bg: #f6f8fa;
            --card: #ffffff;
            --accent: #0d6efd;
            --muted: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --high: #ff6b6b;
            --medium: #ffb84d;
            --low: #6be49b;
        }

        body {
            background: var(--bg);
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            padding-top: 28px;
        }

        .app-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 18px;
        }

        .app-logo {
            height: 56px;
            width: 56px;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.12);
            background: #fff;
        }

        .controls-row .btn {
            white-space: nowrap;
        }

        .priority-badge {
            padding: .35rem .6rem;
            border-radius: .6rem;
            font-weight: 600;
            color: #fff;
            font-size: .85rem;
        }

        .priority-high {
            background: var(--high);
        }

        .priority-medium {
            background: var(--medium);
            color: #000;
        }

        .priority-low {
            background: var(--low);
            color: #000;
        }

        .table-wrap {
            background: var(--card);
            border-radius: .6rem;
            padding: 1rem;
            box-shadow: 0 8px 30px rgba(16, 24, 40, 0.06);
        }

        .completed-row {
            opacity: 0.65;
            text-decoration: line-through;
        }

        .small-muted {
            color: var(--muted);
            font-size: .9rem;
        }

        @media (max-width: 768px) {
            .controls-row {
                flex-direction: column;
                gap: 10px;
            }

            .app-header h1 {
                font-size: 1.25rem;
            }
        }
    </style>
</head>

<body>

    <div class="container">

        <!-- Header with logo -->
        <div class="app-header mb-3">
            <!-- replace src with your logo file if you have one -->
            <img class="app-logo" src="1stop_ai_logo.jpeg" alt="Logo">
            <div>
                <h1 class="h4 mb-0">Task Manager</h1>
                <div class="small-muted">Manage tasks • localStorage • search • filter • priority</div>
            </div>
        </div>

        <!-- Controls: Add / Search / Filters / Sort / Clear -->
        <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap controls-row gap-2">
            <div class="d-flex gap-2">
                <button id="btnAdd" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#taskModal">
                    <i class="bi bi-plus-lg"></i> Add Task
                </button>
                <button id="btnClearAll" class="btn btn-outline-danger">
                    <i class="bi bi-trash"></i> Clear All
                </button>
            </div>

            <div class="d-flex gap-2 align-items-center flex-wrap">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input id="searchInput" type="search" class="form-control" placeholder="Search by task or person">
                </div>

                <select id="filterPriority" class="form-select" style="width:160px;">
                    <option value="">All Priority</option>
                    <option value="High">High</option>
                    <option value="Medium">Medium</option>
                    <option value="Low">Low</option>
                </select>

                <select id="filterStatus" class="form-select" style="width:160px;">
                    <option value="">All Status</option>
                    <option value="Pending">Pending</option>
                    <option value="Completed">Completed</option>
                </select>

                <select id="sortETA" class="form-select" style="width:170px;">
                    <option value="">Sort by ETA</option>
                    <option value="asc">ETA ↑ (Sooner first)</option>
                    <option value="desc">ETA ↓ (Later first)</option>
                </select>
            </div>
        </div>

        <!-- Table container -->
        <div class="table-wrap mb-4">
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 48px;">#</th>
                            <th>Task / Description</th>
                            <th style="width: 150px;">Responsible</th>
                            <th style="width: 120px;">ETA</th>
                            <th style="width:110px;">Priority</th>
                            <th style="width:140px;">Status</th>
                            <th style="width: 110px;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="taskTableBody">
                        <!-- rows injected here -->
                    </tbody>
                </table>
            </div>

            <div id="noTasksMsg" class="text-center py-4 small-muted">No tasks yet. Add your first task!</div>
        </div>
    </div>

    <!-- Modal (Add / Edit) -->
    <div class="modal fade" id="taskModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <form id="taskForm" class="needs-validation" novalidate>
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">Add Task</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <input type="hidden" id="taskIndex">
                        <div class="mb-3">
                            <label for="desc" class="form-label">Task / Description</label>
                            <input id="desc" type="text" class="form-control"
                                placeholder="Add your task or short description" required>
                            <div class="invalid-feedback">Please provide a task description.</div>
                        </div>

                        <div class="mb-3">
                            <label for="person" class="form-label">Responsible</label>
                            <input id="person" type="text" class="form-control"
                                placeholder="Add responsible person's name" required>
                            <div class="invalid-feedback">Who is responsible?</div>
                        </div>

                        <div class="row g-2">
                            <div class="col-md-6 mb-3">
                                <label for="eta" class="form-label">ETA</label>
                                <input id="eta" type="date" class="form-control" required>
                                <div class="invalid-feedback">Select ETA</div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="priority" class="form-label">Priority</label>
                                <select id="priority" class="form-select" required>
                                    <option value="High">High</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                                <div class="invalid-feedback">Choose priority</div>
                            </div>
                        </div>

                        <div class="form-check form-switch mt-2">
                            <input class="form-check-input" type="checkbox" id="isCompleted">
                            <label class="form-check-label" for="isCompleted">Mark as completed</label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="saveBtn">Save Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /* ---------------------------
          Advanced To-Do Manager JS
        ----------------------------*/

        const taskTableBody = document.getElementById('taskTableBody');
        const noTasksMsg = document.getElementById('noTasksMsg');

        const searchInput = document.getElementById('searchInput');
        const filterPriority = document.getElementById('filterPriority');
        const filterStatus = document.getElementById('filterStatus');
        const sortETA = document.getElementById('sortETA');

        const taskForm = document.getElementById('taskForm');
        const modalTitle = document.getElementById('modalTitle');
        const taskIndexInput = document.getElementById('taskIndex');
        const descInput = document.getElementById('desc');
        const personInput = document.getElementById('person');
        const etaInput = document.getElementById('eta');
        const prioritySelect = document.getElementById('priority');
        const isCompletedInput = document.getElementById('isCompleted');

        let tasks = JSON.parse(localStorage.getItem('tasks_v2')) || [];

        /* Utility: save & load */
        function saveTasks() {
            localStorage.setItem('tasks_v2', JSON.stringify(tasks));
        }

        /* Render tasks with current filters / search / sort */
        function renderTasks() {
            // apply search
            const q = searchInput.value.trim().toLowerCase();

            let filtered = tasks.filter(t => {
                const matchesQ = q === '' || t.desc.toLowerCase().includes(q) || t.responsible.toLowerCase().includes(q);
                const matchesPriority = filterPriority.value === '' || t.priority === filterPriority.value;
                const matchesStatus = filterStatus.value === '' || (filterStatus.value === 'Completed' ? t.completed : !t.completed);
                return matchesQ && matchesPriority && matchesStatus;
            });

            // sort by ETA if asked
            if (sortETA.value === 'asc') {
                filtered.sort((a, b) => new Date(a.eta) - new Date(b.eta));
            } else if (sortETA.value === 'desc') {
                filtered.sort((a, b) => new Date(b.eta) - new Date(a.eta));
            }

            // clear table
            taskTableBody.innerHTML = '';

            if (filtered.length === 0) {
                noTasksMsg.style.display = 'block';
            } else {
                noTasksMsg.style.display = 'none';
            }

            filtered.forEach((t, idx) => {
                const realIndex = tasks.indexOf(t); // index in main array (important for edits)
                const tr = document.createElement('tr');
                if (t.completed) tr.classList.add('completed-row');

                // index cell
                const tdIndex = document.createElement('td');
                tdIndex.textContent = realIndex + 1;

                // desc
                const tdDesc = document.createElement('td');
                tdDesc.innerHTML = `<strong>${escapeHtml(t.desc)}</strong><div class="small-muted">${escapeHtml(t.notes || '')}</div>`;

                // responsible
                const tdResp = document.createElement('td');
                tdResp.textContent = t.responsible;

                // eta
                const tdETA = document.createElement('td');
                tdETA.innerHTML = formatDateDisplay(t.eta);

                // priority
                const tdPri = document.createElement('td');
                const span = document.createElement('span');
                span.classList.add('priority-badge');
                if (t.priority === 'High') span.classList.add('priority-high');
                else if (t.priority === 'Medium') span.classList.add('priority-medium');
                else span.classList.add('priority-low');
                span.textContent = t.priority;
                tdPri.appendChild(span);

                // status
                const tdStatus = document.createElement('td');
                tdStatus.innerHTML = `
      <div class="form-check form-switch d-flex justify-content-center">
        <input class="form-check-input" type="checkbox" ${t.completed ? 'checked' : ''} onchange="toggleComplete(${realIndex})" id="chk${realIndex}">
      </div>
    `;

                // action
                const tdAction = document.createElement('td');
                tdAction.classList.add('text-center');
                tdAction.innerHTML = `
      <button class="btn btn-sm btn-outline-primary me-1" onclick="openEdit(${realIndex})" title="Edit">
        <i class="bi bi-pencil"></i>
      </button>
      <button class="btn btn-sm btn-outline-danger" onclick="deleteTask(${realIndex})" title="Delete">
        <i class="bi bi-trash"></i>
      </button>
    `;

                tr.appendChild(tdIndex);
                tr.appendChild(tdDesc);
                tr.appendChild(tdResp);
                tr.appendChild(tdETA);
                tr.appendChild(tdPri);
                tr.appendChild(tdStatus);
                tr.appendChild(tdAction);

                taskTableBody.appendChild(tr);
            });
        }

        /* Helpers */
        function formatDateDisplay(isoDate) {
            if (!isoDate) return '<small class="small-muted">No date</small>';
            const d = new Date(isoDate + 'T00:00:00');
            const opts = { year: 'numeric', month: 'short', day: 'numeric' };
            return `<div>${d.toLocaleDateString(undefined, opts)}</div><div class="small-muted">${d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>`;
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;');
        }

        /* Actions */
        function openEdit(index) {
            const t = tasks[index];
            taskIndexInput.value = index;
            descInput.value = t.desc;
            personInput.value = t.responsible;
            etaInput.value = t.eta;
            prioritySelect.value = t.priority;
            isCompletedInput.checked = !!t.completed;
            modalTitle.textContent = 'Edit Task';
            const modal = new bootstrap.Modal(document.getElementById('taskModal'));
            modal.show();
        }

        function toggleComplete(index) {
            tasks[index].completed = !tasks[index].completed;
            saveTasks();
            renderTasks();
        }

        function deleteTask(index) {
            if (!confirm('Delete this task?')) return;
            tasks.splice(index, 1);
            saveTasks();
            renderTasks();
        }

        /* Open Add modal: reset form */
        document.getElementById('btnAdd').addEventListener('click', () => {
            taskForm.reset();
            taskIndexInput.value = '';
            modalTitle.textContent = 'Add Task';
            isCompletedInput.checked = false;
        });

        /* Save (Add or Edit) */
        taskForm.addEventListener('submit', function (e) {
            e.preventDefault();

            // validation bootstrap style
            if (!taskForm.checkValidity()) {
                taskForm.classList.add('was-validated');
                return;
            }

            const idx = taskIndexInput.value;
            const obj = {
                desc: descInput.value.trim(),
                responsible: personInput.value.trim(),
                eta: etaInput.value,
                priority: prioritySelect.value,
                completed: !!isCompletedInput.checked,
                notes: '' // reserved
            };

            if (idx === '') {
                tasks.push(obj);
            } else {
                tasks[Number(idx)] = obj;
            }

            saveTasks();
            renderTasks();

            // hide modal
            const modalEl = document.getElementById('taskModal');
            const modalInst = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
            modalInst.hide();
            taskForm.classList.remove('was-validated');
            taskForm.reset();
        });

        /* Clear All */
        document.getElementById('btnClearAll').addEventListener('click', () => {
            if (!confirm('Clear all tasks?')) return;
            tasks = [];
            saveTasks();
            renderTasks();
        });

        /* Filters & Search events */
        searchInput.addEventListener('input', renderTasks);
        filterPriority.addEventListener('change', renderTasks);
        filterStatus.addEventListener('change', renderTasks);
        sortETA.addEventListener('change', renderTasks);

        /* Init */
        renderTasks();

        /* Expose some functions for inline handlers */
        window.openEdit = openEdit;
        window.deleteTask = deleteTask;
        window.toggleComplete = toggleComplete;

    </script>
</body>

</html>
